<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0A0F1A">
    <title>NeuroMind Pro | Singularity Edition</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Third-party libraries -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.2.1/dist/chart.umd.js"></script>

    <!-- ======================================================================= -->
    <!-- [ STYLES - Singularity Edition ]                                        -->
    <!-- ======================================================================= -->
    <style>
        :root {
            --primary: #805AD5; /* Purple */
            --primary-light: #B794F4;
            --secondary: #3182CE; /* Blue */
            --success: #38A169; /* Green */
            --warning: #D69E2E; /* Yellow */
            --danger: #E53E3E;  /* Red */
            --card-bg: rgba(10, 15, 26, 0.6);
            --glass: rgba(255, 255, 255, 0.04);
            --text: #E2E8F0;
            --text-muted: #A0AEC0;
            --bg: #0A0F1A; /* Very Dark Blue */
            --border: rgba(255, 255, 255, 0.1);
            /* Neurofeedback colors */
            --ambiance-color: rgba(49, 130, 206, 0); /* Initial transparent */
        }
        html { font-size: 16px; scroll-behavior: smooth; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
            background-image: radial-gradient(circle at 1% 1%, var(--ambiance-color) 0%, transparent 40%),
                              radial-gradient(circle at 99% 99%, var(--ambiance-color) 0%, transparent 40%);
            transition: background-image 2s linear;
            overflow-x: hidden;
        }
        #app-root { max-width: 1800px; margin: 0 auto; padding: 1rem; }
        
        /* --- Core Layout & Components --- */
        .app-loader { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; font-size: 1.25rem; color: var(--primary-light); text-align: center; }
        .app-loader i { font-size: 3rem; margin-bottom: 1rem; animation: fa-spin 2s linear infinite; }
        .loader-subtext { font-size: 0.9rem; color: var(--text-muted); margin-top: 1rem; max-width: 400px; }
        header { text-align: center; padding: 1rem 0 2rem; }
        .logo { font-size: 2.5rem; font-weight: 800; letter-spacing: 1px; background: linear-gradient(45deg, var(--primary-light), var(--secondary)); -webkit-background-clip: text; background-clip: text; color: transparent; }
        .nav-tabs { display: flex; justify-content: center; gap: 0.75rem; margin-top: 2rem; flex-wrap: wrap; }
        .tab-btn { background: transparent; border: 1px solid var(--border); color: var(--text); padding: 0.75rem 1.25rem; border-radius: 50px; cursor: pointer; transition: all 0.2s ease-in-out; display: flex; align-items: center; gap: 0.5rem; font-weight: 600; }
        .tab-btn:hover { background: var(--glass); border-color: var(--primary-light); transform: translateY(-2px); }
        .tab-btn.active { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 5px 15px rgba(128, 90, 213, 0.2); }
        .tab-content { display: none; animation: fadeIn 0.5s; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .page-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); gap: 1.5rem; }
        .card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; padding: 1.5rem; backdrop-filter: blur(15px); }
        .card-header { margin: -1.5rem -1.5rem 1.5rem -1.5rem; padding: 1rem 1.5rem; border-bottom: 1px solid var(--border); background: rgba(0,0,0,0.1); border-radius: 12px 12px 0 0; }
        .card-title { font-size: 1.25rem; color: var(--text); display: flex; align-items: center; gap: 0.75rem; }
        .card-title i { color: var(--primary-light); }
        .button { background: var(--primary); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; transition: all 0.2s; font-weight: 600; }
        .button:hover { background: var(--primary-light); transform: translateY(-2px); }
        .button.secondary { background: var(--secondary); }
        .button.danger { background: var(--danger); }

        /* --- AI Coach & Player --- */
        #ai-coach-container { 
            position: fixed; 
            bottom: 20px; 
            left: 20px; 
            background: var(--card-bg); 
            border-radius: 10px; 
            padding: 1rem; 
            border: 1px solid var(--border); 
            max-width: 350px; 
            z-index: 1000; 
            display: flex; 
            align-items: center; 
            gap: 1rem; 
            animation: slideInUp 0.5s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        @keyframes slideInUp { from { opacity: 0; transform: translateY(50px); } to { opacity: 1; transform: translateY(0); } }
        #ai-coach-avatar { font-size: 2rem; color: var(--primary); }
        #ai-coach-message { font-size: 0.9rem; font-style: italic; }
        
        #media-player-container { 
            position: fixed; 
            bottom: 20px; 
            right: 20px; 
            background: var(--card-bg); 
            border-radius: 10px; 
            padding: 1rem; 
            border: 1px solid var(--border); 
            max-width: 350px; 
            z-index: 1000; 
            animation: slideInUp 0.5s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        .player-controls {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        .player-btn {
            background: var(--glass);
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text);
            cursor: pointer;
            transition: all 0.2s;
        }
        .player-btn:hover {
            background: var(--primary);
            transform: scale(1.1);
        }

        /* --- NeuroApp Game Specific --- */
        .neuro-game-container { max-width: 900px; margin: auto; text-align: center; }
        .game-stimulus { min-height: 150px; display: flex; justify-content: center; align-items: center; font-size: 4rem; margin: 2rem 0; font-weight: bold; }
        .game-stimulus.feedback-correct { color: var(--success); }
        .game-stimulus.feedback-incorrect { color: var(--danger); animation: shake 0.5s; }
        @keyframes shake { 10%, 90% { transform: translate3d(-2px, 0, 0); } 20%, 80% { transform: translate3d(4px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-6px, 0, 0); } 40%, 60% { transform: translate3d(6px, 0, 0); } }
        .game-hud { display: flex; justify-content: space-around; padding: 1rem; background: var(--glass); border-radius: 8px; margin-bottom: 2rem; }
        .hud-item { text-align: center; }
        .hud-label { font-size: 0.8rem; color: var(--text-muted); }
        .hud-value { font-size: 1.5rem; font-weight: bold; }

        /* --- EEG 3D Visualizer --- */
        #eeg-3d-container { height: 500px; position: relative; border-radius: 8px; overflow: hidden; background: #000; cursor: grab; }
        #eeg-3d-container:active { cursor: grabbing; }

        /* --- Progress Tab --- */
        .progress-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem; }
        .radar-chart-container, .trend-chart-container { height: 400px; }
        
        /* --- Floating Coach Animations --- */
        .coach-pulse {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* --- Responsive Adjustments --- */
        @media (max-width: 768px) {
            #ai-coach-container, #media-player-container {
                max-width: 280px;
                padding: 0.75rem;
                font-size: 0.85rem;
            }
            .player-controls {
                gap: 0.3rem;
            }
            .player-btn {
                width: 30px;
                height: 30px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div id="app-root">
        <div class="app-loader">
            <i class="fas fa-brain"></i>
            <div>Initializing NeuroMind Platform...</div>
            <div class="loader-subtext" id="loader-status">Bootstrapping cognitive core...</div>
        </div>
    </div>
    
    <div id="ai-coach-container" style="display: none;">
        <i id="ai-coach-avatar" class="fas fa-robot coach-pulse"></i>
        <p id="ai-coach-message"></p>
    </div>
    
    <div id="media-player-container" style="display: none;">
        <div class="card-title"><i class="fas fa-music"></i> Meditation Player</div>
        <div id="player-title">Ocean Waves Meditation</div>
        <div class="player-controls">
            <button class="player-btn" id="player-prev"><i class="fas fa-step-backward"></i></button>
            <button class="player-btn" id="player-play"><i class="fas fa-play"></i></button>
            <button class="player-btn" id="player-next"><i class="fas fa-step-forward"></i></button>
            <button class="player-btn" id="player-vol"><i class="fas fa-volume-up"></i></button>
        </div>
    </div>

    <!-- ======================================================================= -->
    <!-- [ JAVASCRIPT LOGIC - Singularity Edition ]                              -->
    <!-- ======================================================================= -->
    <script type="module">
        // --- [ EMBEDDED ASSETS & CONFIGURATION ] ---
        const ASSETS = {
            // Embedded UI Sound Effects
            SOUND_CLICK_B64: 'data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA',
            SOUND_SUCCESS_B64: 'data:audio/wav;base64,UklGRlIAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhSAAAAEAAAAB1AAAAgwAAAJQAAACzAAAAtgAAALMAAACsAAAAqAAAAJkAAACNAAAAhwAAAGwAAABWAAAAQwAAACoAAAAgAAAAEwAAAAcAAAADAAAAAQAAAAE=',
            // Embedded Meditation Audio
            MEDITATION_OCEAN_B64: 'https://assets.mixkit.co/active_storage/sfx/250/250-preview.mp3',
            MEDITATION_FOREST_B64: 'https://assets.mixkit.co/active_storage/sfx/243/243-preview.mp3',
            MEDITATION_RAIN_B64: 'https://assets.mixkit.co/active_storage/sfx/240/240-preview.mp3'
        };

        // --- [ UTILITY MODULE ] ---
        const Utils = {
            uid: () => Date.now().toString(36) + Math.random().toString(36).substr(2, 5),
            log: (message) => console.log(`[NeuroMind] ${message}`),
            calculateStdDev: (arr) => {
                const n = arr.length;
                if (n === 0) return 0;
                const mean = arr.reduce((a, b) => a + b) / n;
                return Math.sqrt(arr.map(x => Math.pow(x - mean, 2)).reduce((a, b) => a + b) / n);
            }
        };
        
        // --- [ AUDIO CONTROLLER MODULE ] ---
        class AudioController {
            constructor() {
                this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                this.ambianceGain = this.audioContext.createGain();
                this.ambianceGain.gain.value = 0.1;
                this.ambianceGain.connect(this.audioContext.destination);
                
                this.binauralOsc1 = null;
                this.binauralOsc2 = null;
                this.activeSound = null;
                this.meditationTracks = [
                    { title: "Ocean Waves", src: ASSETS.MEDITATION_OCEAN_B64 },
                    { title: "Forest Ambience", src: ASSETS.MEDITATION_FOREST_B64 },
                    { title: "Gentle Rain", src: ASSETS.MEDITATION_RAIN_B64 }
                ];
                this.currentTrackIndex = 0;
                this.isPlaying = false;
                Utils.log("Audio Controller Initialized.");
            }
            
            playSound(base64) {
                const sound = new Audio(base64);
                sound.play();
            }

            playBinauralBeat(baseFreq, beatFreq) {
                if (this.binauralOsc1) {
                    this.binauralOsc1.stop();
                    this.binauralOsc2.stop();
                }
                this.binauralOsc1 = this.audioContext.createOscillator();
                this.binauralOsc2 = this.audioContext.createOscillator();
                this.binauralOsc1.type = 'sine';
                this.binauralOsc2.type = 'sine';
                this.binauralOsc1.frequency.setValueAtTime(baseFreq - (beatFreq / 2), this.audioContext.currentTime);
                this.binauralOsc2.frequency.setValueAtTime(baseFreq + (beatFreq / 2), this.audioContext.currentTime);
                this.binauralOsc1.connect(this.ambianceGain);
                this.binauralOsc2.connect(this.ambianceGain);
                this.binauralOsc1.start();
                this.binauralOsc2.start();
            }
            
            playMeditationTrack(index = null) {
                if (index !== null) this.currentTrackIndex = index;
                if (this.activeSound) {
                    this.activeSound.pause();
                    this.activeSound = null;
                }
                
                const track = this.meditationTracks[this.currentTrackIndex];
                this.activeSound = new Audio(track.src);
                this.activeSound.loop = true;
                this.activeSound.play();
                this.isPlaying = true;
                
                // Update player UI
                document.getElementById('player-title').textContent = track.title;
                document.getElementById('player-play').innerHTML = '<i class="fas fa-pause"></i>';
                
                return this.activeSound;
            }
            
            togglePlayback() {
                if (!this.activeSound) return;
                
                if (this.isPlaying) {
                    this.activeSound.pause();
                    document.getElementById('player-play').innerHTML = '<i class="fas fa-play"></i>';
                } else {
                    this.activeSound.play();
                    document.getElementById('player-play').innerHTML = '<i class="fas fa-pause"></i>';
                }
                this.isPlaying = !this.isPlaying;
            }
            
            nextTrack() {
                this.currentTrackIndex = (this.currentTrackIndex + 1) % this.meditationTracks.length;
                this.playMeditationTrack();
            }
            
            prevTrack() {
                this.currentTrackIndex = (this.currentTrackIndex - 1 + this.meditationTracks.length) % this.meditationTracks.length;
                this.playMeditationTrack();
            }

            stopAllSounds() {
                if (this.binauralOsc1) {
                    this.binauralOsc1.stop();
                    this.binauralOsc2.stop();
                    this.binauralOsc1 = null;
                    this.binauralOsc2 = null;
                }
                if (this.activeSound) {
                    this.activeSound.pause();
                    this.activeSound = null;
                    this.isPlaying = false;
                }
            }
        }

        // --- [ MAIN APPLICATION CLASS ] ---
        class App {
            constructor(rootEl) {
                this.rootEl = rootEl;
                this.state = {};
                this.charts = {};
                this.audioController = new AudioController();
                this.coachMessages = [
                    "Focus on your breathing to enhance concentration...",
                    "Your cognitive performance is improving steadily...",
                    "Try closing your eyes during meditation for deeper focus...",
                    "Your reaction time is faster today - great progress!",
                    "Deep breathing can help reduce mental fatigue...",
                    "Notice how your mind wanders - gently bring it back...",
                    "Your brainwave patterns show increased focus..."
                ];
                this.coachIcons = [
                    'fa-lightbulb', 'fa-chart-line', 'fa-brain', 
                    'fa-bolt', 'fa-wind', 'fa-mind-share', 'fa-wave-square'
                ];
                
                this.loadState();
                this.ui = new UIManager(this, this.rootEl);
            }
            
            async init() {
                this.ui.showLoader("Initializing EEG Worker...");
                
                this.ui.showLoader("Platform ready. Welcome back.");
                this.state.system.ready = true;
                this.update();
                
                this.audioController.playBinauralBeat(100, 10);
                this.showCoachMessage(`Welcome, ${this.state.user.name}. Let's begin your cognitive journey.`, 'fa-hand-sparkles');
                
                // Start random coach messages
                setInterval(() => {
                    if (this.state.system.ready) {
                        const randomIndex = Math.floor(Math.random() * this.coachMessages.length);
                        this.showCoachMessage(
                            this.coachMessages[randomIndex],
                            this.coachIcons[randomIndex]
                        );
                    }
                }, 30000);
            }
            
            loadState() {
                const savedState = localStorage.getItem('neuroMindState');
                if (savedState) {
                    this.state = JSON.parse(savedState);
                    this.state.game.inProgress = false;
                } else {
                    this.state = {
                        system: { ready: false },
                        ui: { activeTab: 'dashboard' },
                        user: { name: 'Cogninaut', level: 1, xp: 0 },
                        cognitiveProfile: { memory: 50, attention: 65, speed: 70, problemSolving: 55, flexibility: 60 },
                        sessions: [],
                        eeg: { bands: { delta: 0.1, theta: 0.2, alpha: 0.4, beta: 0.3 } },
                        game: { inProgress: false }
                    };
                }
            }
            
            saveState() {
                localStorage.setItem('neuroMindState', JSON.stringify(this.state));
            }

            update() {
                this.ui.render(this.state);
                this.saveState();
            }
            
            handleAction(action, payload) {
                Utils.log(`Action: ${action}`, payload || '');
                this.audioController.playSound(ASSETS.SOUND_CLICK_B64);

                switch (action) {
                    case 'CHANGE_TAB':
                        this.state.ui.activeTab = payload;
                        if (payload === 'mindfulness') {
                            this.showCoachMessage("Mindfulness practices can enhance focus and reduce stress.", 'fa-spa');
                        }
                        break;
                    case 'TOGGLE_PLAYER':
                        this.audioController.togglePlayback();
                        break;
                    case 'NEXT_TRACK':
                        this.audioController.nextTrack();
                        break;
                    case 'PREV_TRACK':
                        this.audioController.prevTrack();
                        break;
                    case 'START_MEDITATION':
                        this.audioController.playMeditationTrack(payload);
                        document.getElementById('media-player-container').style.display = 'block';
                        this.showCoachMessage("Beginning meditation session. Focus on your breath...", 'fa-spa');
                        break;
                }
                this.update();
            }

            showCoachMessage(text, icon = 'fa-robot') {
                const container = document.getElementById('ai-coach-container');
                const avatar = document.getElementById('ai-coach-avatar');
                const message = document.getElementById('ai-coach-message');
                
                if (container && avatar && message) {
                    container.style.display = 'flex';
                    avatar.className = `fas ${icon} coach-pulse`;
                    message.textContent = text;
                    
                    // Auto-hide after 8 seconds
                    setTimeout(() => {
                        container.style.display = 'none';
                    }, 8000);
                }
            }
        }

        // --- [ UI MANAGER CLASS ] ---
        class UIManager {
            constructor(app, rootEl) {
                this.app = app;
                this.rootEl = rootEl;
                this.three = { scene: null, camera: null, renderer: null, brain: null };
            }
            
            showLoader(text) {
                const status = document.getElementById('loader-status');
                if (status) status.textContent = text;
            }
            
            render(state) {
                const { ui, system } = state;
                if (!system.ready) return;

                const content = this.renderTabContent(ui.activeTab, state);

                this.rootEl.innerHTML = `
                    <header>
                        <div class="logo">NeuroMind Pro</div>
                        <nav class="nav-tabs">
                            <button class="tab-btn ${ui.activeTab === 'dashboard' ? 'active' : ''}" data-action="CHANGE_TAB" data-payload="dashboard"><i class="fas fa-home"></i> Dashboard</button>
                            <button class="tab-btn ${ui.activeTab === 'neuro-game' ? 'active' : ''}" data-action="CHANGE_TAB" data-payload="neuro-game"><i class="fas fa-gamepad"></i> Training</button>
                            <button class="tab-btn ${ui.activeTab === 'analysis' ? 'active' : ''}" data-action="CHANGE_TAB" data-payload="analysis"><i class="fas fa-brain"></i> EEG Analysis</button>
                            <button class="tab-btn ${ui.activeTab === 'progress' ? 'active' : ''}" data-action="CHANGE_TAB" data-payload="progress"><i class="fas fa-chart-line"></i> Progress</button>
                            <button class="tab-btn ${ui.activeTab === 'mindfulness' ? 'active' : ''}" data-action="CHANGE_TAB" data-payload="mindfulness"><i class="fas fa-spa"></i> Mindfulness</button>
                        </nav>
                    </header>
                    <main class="tab-content active">${content}</main>
                `;
                this.attachEventListeners();
                this.postRender(state);
            }
            
            renderDashboard(state) {
                return `
                    <div class="page-grid">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title"><i class="fas fa-brain"></i> Cognitive Profile</div>
                            </div>
                            <div class="radar-chart-container">
                                <canvas id="radarChart"></canvas>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title"><i class="fas fa-tasks"></i> Daily Goals</div>
                            </div>
                            <div class="progress-grid">
                                <div>
                                    <div class="hud-item">
                                        <div class="hud-label">Meditation</div>
                                        <div class="hud-value">0/10 min</div>
                                    </div>
                                    <div class="hud-item">
                                        <div class="hud-label">Training</div>
                                        <div class="hud-value">0/3 sessions</div>
                                    </div>
                                </div>
                                <div>
                                    <button class="button" data-action="START_MEDITATION" data-payload="0">Start Meditation</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title"><i class="fas fa-chart-line"></i> Weekly Progress</div>
                            </div>
                            <div class="trend-chart-container">
                                <canvas id="trendChart"></canvas>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            renderTabContent(tab, state) {
                switch (tab) {
                    case 'dashboard': return this.renderDashboard(state);
                    case 'mindfulness': return this.renderMindfulness(state);
                    default: return `<div class="card"><p>Module under development</p></div>`;
                }
            }
            
            renderMindfulness(state) {
                return `
                    <div class="page-grid">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title"><i class="fas fa-spa"></i> Guided Meditations</div>
                            </div>
                            <div class="meditation-options">
                                <div class="meditation-option" data-action="START_MEDITATION" data-payload="0">
                                    <i class="fas fa-water"></i>
                                    <span>Ocean Waves</span>
                                </div>
                                <div class="meditation-option" data-action="START_MEDITATION" data-payload="1">
                                    <i class="fas fa-tree"></i>
                                    <span>Forest Ambience</span>
                                </div>
                                <div class="meditation-option" data-action="START_MEDITATION" data-payload="2">
                                    <i class="fas fa-cloud-rain"></i>
                                    <span>Gentle Rain</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title"><i class="fas fa-brain"></i> Mindfulness Tips</div>
                            </div>
                            <div class="mindfulness-tips">
                                <p>• Focus on your breath to anchor your attention</p>
                                <p>• Notice thoughts without judgment, let them pass</p>
                                <p>• Start with 5-minute sessions and gradually increase</p>
                                <p>• Practice daily for best results</p>
                            </div>
                        </div>
                    </div>
                    <style>
                        .meditation-options {
                            display: grid;
                            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                            gap: 1rem;
                            margin-top: 1rem;
                        }
                        .meditation-option {
                            background: var(--glass);
                            border-radius: 8px;
                            padding: 1rem;
                            text-align: center;
                            cursor: pointer;
                            transition: all 0.3s;
                        }
                        .meditation-option:hover {
                            background: var(--primary);
                            transform: translateY(-5px);
                        }
                        .meditation-option i {
                            font-size: 2rem;
                            margin-bottom: 0.5rem;
                            display: block;
                        }
                        .mindfulness-tips p {
                            margin-bottom: 0.8rem;
                            padding-left: 1.5rem;
                            position: relative;
                        }
                        .mindfulness-tips p:before {
                            content: "•";
                            position: absolute;
                            left: 0;
                            color: var(--primary-light);
                        }
                    </style>
                `;
            }

            attachEventListeners() {
                this.rootEl.addEventListener('click', (e) => {
                    const target = e.target.closest('[data-action]');
                    if (target) {
                        const { action, payload } = target.dataset;
                        this.app.handleAction(action, payload);
                    }
                });
                
                // Player controls
                document.getElementById('player-play')?.addEventListener('click', () => {
                    this.app.handleAction('TOGGLE_PLAYER');
                });
                document.getElementById('player-next')?.addEventListener('click', () => {
                    this.app.handleAction('NEXT_TRACK');
                });
                document.getElementById('player-prev')?.addEventListener('click', () => {
                    this.app.handleAction('PREV_TRACK');
                });
            }
            
            postRender(state) {
                // Initialize charts
                this.initCharts();
            }
            
            initCharts() {
                // Radar Chart (Cognitive Profile)
                const radarCtx = document.getElementById('radarChart')?.getContext('2d');
                if (radarCtx) {
                    new Chart(radarCtx, {
                        type: 'radar',
                        data: {
                            labels: ['Memory', 'Attention', 'Speed', 'Problem Solving', 'Flexibility'],
                            datasets: [{
                                label: 'Your Profile',
                                data: [
                                    this.app.state.cognitiveProfile.memory,
                                    this.app.state.cognitiveProfile.attention,
                                    this.app.state.cognitiveProfile.speed,
                                    this.app.state.cognitiveProfile.problemSolving,
                                    this.app.state.cognitiveProfile.flexibility
                                ],
                                backgroundColor: 'rgba(128, 90, 213, 0.2)',
                                borderColor: 'rgba(128, 90, 213, 1)',
                                pointBackgroundColor: 'rgba(128, 90, 213, 1)',
                                pointBorderColor: '#fff',
                                pointHoverBackgroundColor: '#fff',
                                pointHoverBorderColor: 'rgba(128, 90, 213, 1)'
                            }]
                        },
                        options: {
                            scales: {
                                r: {
                                    angleLines: { color: 'rgba(255, 255, 255, 0.1)' },
                                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                    pointLabels: { color: 'var(--text)' },
                                    suggestedMin: 0,
                                    suggestedMax: 100
                                }
                            },
                            plugins: {
                                legend: { labels: { color: 'var(--text)' } }
                            }
                        }
                    });
                }
                
                // Trend Chart (Weekly Progress)
                const trendCtx = document.getElementById('trendChart')?.getContext('2d');
                if (trendCtx) {
                    new Chart(trendCtx, {
                        type: 'line',
                        data: {
                            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                            datasets: [{
                                label: 'Cognitive Score',
                                data: [65, 72, 68, 75, 80, 78, 82],
                                borderColor: 'rgba(56, 161, 105, 1)',
                                backgroundColor: 'rgba(56, 161, 105, 0.1)',
                                tension: 0.3,
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: {
                                    min: 50,
                                    max: 100,
                                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                    ticks: { color: 'var(--text-muted)' }
                                },
                                x: {
                                    grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                    ticks: { color: 'var(--text-muted)' }
                                }
                            },
                            plugins: {
                                legend: { labels: { color: 'var(--text)' } }
                            }
                        }
                    });
                }
            }
        }

        // Initialize the application
        new App(document.getElementById('app-root')).init();
    </script>
</body>
</html>
